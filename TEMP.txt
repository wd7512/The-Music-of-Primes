b'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <!-- iid: 4122 -->\n    <meta charset="utf-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">\n            \n<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">\n\n    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css" rel="stylesheet">\n\n    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">\n    <link href="/css617/LibCal_public.min.css" rel="stylesheet">\n    <link href="/css617/print.min.css" rel="stylesheet" media="print">\n    \n\n    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>\n    <script>\n        window.jQuery || document.write(\'<script src="/js617/jquery.min.js">\\x3C/script>\');\n    </script>\n\n        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>\n    <script>\n        jQuery.ui || document.write(\'<script src="/js617/jquery-ui.min.js">\\x3C/script>\');\n    </script>\n\n    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>\n    <script>\n        (typeof $().modal == \'function\') || document.write(\'<script src="/js617/bootstrap.min.js">\\x3C/script>\');\n    </script>\n    <script src="/js617/LibCal_public.min.js"></script>\n        <script>\n    springSpace.dateFormat = "dddd, MMMM D, YYYY";\n    springSpace.dateShortFormat = "ddd MMM Do YYYY";\n    springSpace.timeFormat = "h:mma";\n    springSpace.timezone = \'Europe/London\';\n    springSpace.currency = "EUR";\n    springSpace.currencySymbol = "\xe2\x82\xac";\n\n    springSpace.language = \'en\'; // en\n    springSpace.locale = \'en-US\'; // en-US\n\n    springSpace.phpTimeFormat = \'g:ia\';\n\n    springSpace.bootstrapAsset = \'/css617/bootstrap.min.css\';\n    springSpace.publicCssAsset = \'/css617/LibCal_public.min.css\';\n    springSpace.adminCssAsset = \'/css617/LibCal_admin.min.css\';\n\n    jQuery(function() {\n                moment.locale(springSpace.locale);\n\n                setupDatePickerLanguage();\n    });\n</script>\n    <script>\n         var springLang  = { eq_GoToNextAvailable: "Next Available", eq_js_add_cart_btn: "Add to Cart", eq_js_add_cc_btn: "Add to Cart & Checkout", eq_js_add_eq_btn: "Add Equipment", eq_js_add_start: "All additional items must have a starting time of", eq_js_add_to_cart: "Add Item to Cart", eq_js_booking_summary_title: "Thank you!", eq_js_cart_tt: "Create a shopping cart with these space bookings, and go to equipment booking page to add more items to the cart.", eq_js_close: "Close", eq_js_date: "Change Return Date", eq_js_det_return: "Determining return time", eq_js_from: "From:", eq_js_from_det: "from", eq_js_go_to_date: "Go To Date", eq_js_isRequired: "is required!", eq_js_rem_pending: "Remove Pending Booking", eq_js_spacew_forb_multi: "Forbidden from booking same resource multiple times in a single booking.<br><br>Please only select sequential checkboxes.", eq_js_spacew_forb_single: "Forbidden from booking different resources in a single booking.", eq_js_to: "To:", eq_js_until_det: "until...", eq_start_over: "Make Another Booking", eq_unavail: "Unavailable/Padding", eq_your_book: "Your Booking" };\n    </script>\n        <title>          Space Availability\n     - Study Spaces - University of Bath</title>\n        <link rel="stylesheet" href="/css617/fullcalendar.min.css"/>\n\n    <style>\n    .s-lc-eq-avail, .label-eq-avail, .s-lc-eq-period-available {\n        background: #14951F none !important;\n        border-color: #14951F !important;\n    }\n\n    .s-lc-eq-avail:hover, .s-lc-eq-period-available:hover {\n        background: #095212 none !important;\n        border-color: #095212 !important;\n    }\n\n    .s-lc-eq-pending, .label-eq-pending, .s-lc-eq-period-pending {\n        background: #F59F16 none !important;\n        border-color: #F59F16 !important;\n    }\n\n    .s-lc-eq-checkout, .s-lc-eq-r-unavailable, .s-lc-eq-r-padding, .label-eq-unavailable, .s-lc-eq-period-booked {\n        background: #C91908 none !important;\n        border-color: #C91908 !important;\n    }\n</style>\n\n    <style>\n        @media (max-width: 768px) {\n            .fc-timeline .fc-cell-text {\n                font-size: 12px !important;\n            }\n        }\n    </style>\n    \n</head>\n<body id="equip_" class="s-lc-public s-lc-public-page-5">\n\n<div class="sr-only" title="Information for Screenreader Users">\n                        <a href="/spaces/accessible/1642">\n        Alternate Page for Screenreader Users\n    </a>\n\n    </div>\n<a id="s-lc-public-skiplink" class="s-lc-skiplink alert-info" href="#s-lc-public-main">Skip to Main Content</a>\n\n\n<div class="container">\n            <div id="s-lc-public-banner" class="row" role="banner">\n            <a href="https://bath.libcal.com/">\n                <img alt="University of Bath Study Spaces" class="img-responsive" id="s-lc-public-banner-img" src="//lcimages-eu.s3.amazonaws.com/data/headers/4122/Study-Spaces_LibCal-banner_988x106.png" />\n                <span class="sr-only">University of Bath Study Spaces</span>\n            </a>\n        </div>\n    \n            <div id="s-lc-public-bc" class="row">\n            <div class="col-md-12">\n                <ol class="breadcrumb" role="navigation">\n                    <li><a href="https://bath.libcal.com/">University of Bath</a></li>\n                                            <li><a href="/r/new?lid=1642&amp;gid=3007&amp;zone=0&amp;capacity=1&amp;accessible=0&amp;powered=0">New Reservation</a></li>\n                    \n                                        </ol>\n            </div>\n        </div>\n    \n    <noscript>\n        <div class="alert alert-danger" id="noscript">Your browser has javascript disabled. Without javascript some functions will not work.</div>\n    </noscript>\n\n        <div id="s-lc-public-title" class="row s-lc-spaces-setup-info">\n        <div class="col-md-12">\n            <h1 id="s-lc-public-pt">\n                    Space For 1-4 people\n\n@ Virgil Building\n            </h1>\n        </div>\n    </div>\n\n    <main>\n            <div id="s-lc-public-main" class="s-lc-public-main">\n        <div id="s-lc-public-page-content" class="row">\n            \n            <div id="col1" class="col-md-12 center" >\n                    <input type="hidden" id="capacity" value="1">\n\n    \n    \n    \n    <p id="s-lc-new-reservation-filter-text" class="s-lc-spaces-setup-info">\n                    There are 2 booking option(s) available for             the &quot;Group room&quot; category and             all zones.\n            <a id="s-lc-new-reservation-go-back" href="/r/new?lid=1642&amp;gid=3007&amp;zone=0&amp;capacity=1&amp;accessible=0&amp;powered=0">You can go back and change the filters.</a>\n            </p>\n\n                \n                                    <div id="s-lc-group-description" class="s-lc-resource-description s-lc-spaces-setup-info">\n                        <p>This is a single bookable room with a capacity of 2 - 4 people.</p>\r\n\n                    </div>\n                \n                <div id="s-lc-session-warning" class="alert alert-warning" style="display: none;">\n                    Your session is about to expire, <a id="s-lc-session-warning-continue" href="#">click here</a> to continue your session.\n                </div>\n\n                <div id="s-lc-session-expired" class="alert alert-danger" style="display: none;">\n                    Your session has expired, please <a id="s-lc-session-expired-reload" href="#">reload</a> the page to start again.\n                </div>\n\n                <div id="time_grid_cont" class="s-lc-spaces-time-grid s-lc-spaces-setup-info">\n                                    <div id="eq-time-grid">\n    </div>\n\n    <div id="s-lc-time-grid-pagination" class="s-lc-time-grid-pagination">\n    </div>\n\n    <div class="s-lc-time-grid-legend" id="eq-time-grid-legend">\n        <span class="label-eq-cont" data-toggle="tooltip" data-placement="top" title="Slot is available, click to book!"><span class="label label-eq-avail">&nbsp;&nbsp;</span> Available</span>\n<span class="label-eq-cont" data-toggle="tooltip" data-placement="top" title="Your pending booking."><span class="label label-eq-pending">&nbsp;&nbsp;</span> Your Booking</span>\n<span class="label-eq-cont" data-toggle="tooltip" data-placement="top" title="This slot is unavailable for starting a new booking. Bookings may occasionally extend into this slot."><span class="label label-eq-unavailable">&nbsp;&nbsp;</span> Unavailable/Padding</span>    </div>\n\n                    </div>\n\n                <div id="s-lc-eq-form-box" class="s-lc-spaces-setup-info" style="display: none;" role="region" aria-live="polite">\n                    <form id="s-lc-eq-form-times" class="form-horizontal" role="form" method="post">\n                        <fieldset>\n                            <div id="s-lc-eq-bwell" class="well" tabindex="0">&nbsp;</div>\n                            <div id="s-lc-eq-bform-inner" class="col-sm-offset-5">\n                                <button class="btn btn-primary" name="submit_times" id="submit_times">Submit Times</button>&nbsp;\n                                                            </div>\n                        </fieldset>\n                    </form>\n                </div>\n\n                <div id="s-lc-eq-form" style="clear:both; display: none;" role="region" aria-live="polite"></div>\n\n                <div id="s-lc-eq-errors" class="alert alert-danger" style="display: none;" role="region" aria-live="polite"></div>\n\n                <div id="s-lc-eq-success" style="display: none;" role="region" aria-live="polite">\n                    <h1>Thank you!</h1>\n\n                    <div id="s-lc-eq-success-content"></div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n    </main>\n\n    <footer id="s-lc-public-footer" class="s-lc-public-footer row">\n        <div id="s-lc-public-footer-brand">\n            <span title="libcal-eu-2">Powered by</span> <a href="https://www.springshare.com">Springshare</a>.\n        </div>\n        <div id="s-lc-public-footer-rights">\n            All rights reserved.\n        </div>\n\n                    <div id="s-lc-footer-support-link">\n                <a href="mailto:study-spaces@bath.ac.uk">Report a tech support issue.</a>\n            </div>\n        \n                            <div id="s-lc-public-footer-print-link">\n        View this page in a format suitable for\n        <a href="/spaces/accessible/1642">\n            screen-readers\n        </a>\n    </div>\n\n    \n        <div id="s-lc-public-footer-admin-links" role="navigation">\n                            <a id="s-lc-sign-in" href="https://bath.libapps.com/libapps/login.php?site_id=20690&amp;target=">Login to LibApps</a>\n                    </div>\n\n        <div class="s-lc-public-footer-actions">\n    <div id="s-lc-language">\n    <select id="s-lc-language-selector" role="select" aria-label="Language Selector">\n                <option value="cy" >Cymraeg</option>\n                <option value="en" selected>English</option>\n                <option value="es" >espa\xc3\xb1ol</option>\n                <option value="fr" >fran\xc3\xa7ais</option>\n                <option value="sl" >slovenski jezik</option>\n            </select>\n</div></div>\n    </footer>\n\n    \n</div>\n\n\n                            <script type="text/javascript" src="/js617/fullcalendar.min.js"></script>\n        <script src="/js617/datepicker.min.js"></script>\n    <link rel="stylesheet" href="/css617/datepicker.min.css"/>\n\n    <script>\n    var springyFullCalendar = {\n        commonOptions: {\n            schedulerLicenseKey: \'0528536826\\u002Dfcs\\u002D1579267341\',\n            now: \'2020\\u002D11\\u002D11\\u002000\\u003A46\',\n            nowIndicator: true,\n            scrollTime: \'23\\u003A00\\u003A00\',\n            lazyFetching: false,\n            locale: springSpace.language,\n        },\n        timelineOptions: {\n            plugins: [\'moment\', \'resourceTimeline\', \'resourceTimeGrid\'],\n            height: \'auto\',\n            refetchResourcesOnNavigate: false,\n            eventOverlap: false,\n            displayEventTime: false,\n            slotDuration: \'01\\u003A00\',\n            titleFormat: springSpace.dateFormat,\n            views: {\n                timelineSingleDay: {\n                    type: \'resourceTimeline\',\n                    buttonText: \'Day\\u0020View\',\n                    duration: {days: 1},\n                    slotLabelFormat: springSpace.timeFormat,\n                },\n                timelineHourlyShort: {\n                    type: \'resourceTimeline\',\n                    duration: {days: 3},\n                    slotLabelFormat: [springSpace.dateFormat, springSpace.timeFormat],\n                },\n                timelineHourlyLong: {\n                    type: \'resourceTimeline\',\n                    duration: {days: 7},\n                    slotLabelFormat: [springSpace.dateFormat, springSpace.timeFormat],\n                },\n                timelineDailyLong: {\n                    type: \'resourceTimeline\',\n                    slotDuration: \'24:00\',\n                    duration: {days: 28},\n                    slotLabelFormat: [\'dd D\'],\n                    nowIndicator: false\n                },\n                resourceTimeGridWeek: {\n                    buttonText: \'Week\\u0020View\',\n                    dayOfMonthFormat: springSpace.dateShortFormat,\n                    slotLabelFormat: [springSpace.dateShortFormat, springSpace.timeFormat],\n                }\n            },\n        },\n        publicTexts: {\n            goToDate: \'Go\\u0020To\\u0020Date\',\n            goToNextAvailable: \'Next\\u0020Available\',\n            goPrevious: \'Previous\',\n            goNext: \'Next\',\n            allDay: \'All\\u0020Day\',\n            available: \'Available\',\n            unavailable: \'Unavailable\\/Padding\',\n            yourBooking: \'Your\\u0020Booking\',\n        },\n        adminTexts: {\n            goToDate: "Go\\u0020To\\u0020Date",\n            refresh: "Refresh",\n            today: "Today",\n            week: "Week",\n            month: "Month",\n            day: "Day",\n            dayGridWeek: "Agenda",\n            allDay: \'All\\u0020Day\',\n        },\n        dateTimeFormats: {\n            monthViewTitle: \'MMMM YYYY\',\n        },\n    };\n\n    // placeholder for dynamic content boxes with a full calendar\n    var calendarList = {};\n</script>\n<script src="/js617/direct/full-calendar-common.min.js"></script>\n\n    <script src="/js617/direct/public/equipment/common.min.js"></script>\n    <script src="/js617/direct/public/equipment/spaces.min.js"></script>\n    <script>\n        var pendingRoomBookings = [];\n        var pendingBookingNextId = 1;\n        var pendingBookingsBlowAwayCart = false;\n\n        function addError(msg, id) {\n            jQuery(".s-lc-eq-" + id).addClass("has-error").find(".form-control").attr("aria-invalid", true);\n            jQuery(".s-lc-eq-" + id).find(".s-lc-eq-flab").append(\'<div class="error-message">\' + msg + "</div>");\n            jQuery("#" + id).focus();\n            return false;\n        }\n\n        function removeErrors() {\n            jQuery(".s-lc-eq-q").removeClass("has-error").find(".error-message").remove();\n        }\n\n        function agreeToTermsAndConditions() {\n            jQuery("#bform-terms-container").hide();\n\n            // sometimes we need to check the patron\'s email before showing the booking form\n            var emailRestrictionCheck = jQuery("#s-lc-booking-restriction-check");\n            if (emailRestrictionCheck.length > 0) {\n                emailRestrictionCheck.show();\n                return false;\n            }\n\n            // other times we jump directly to the booking form\n            jQuery("#bform-form-container").show();\n\n            scrollAndFocusOnElement(\'#s-lc-bform-help\');\n\n            springySpaces.updateSession();\n\n            return false;\n        }\n\n                var locationIsUsingLibAuth = false;\n\n        function customFormValidation() {\n            // exists to be overwritten by the specific group validation function\n        }\n\n        function submitPendingRoomBookings(forcedEmail) {\n            removeErrors();\n            jQuery("#s-lc-eq-errors").hide();\n\n            if (!isVisibleFieldsValid()) {\n                return false;\n            }\n\n            if (!customFormValidation()) {\n                return false;\n            }\n\n            var payload = {\n                formData: jQuery("#s-lc-eq-bform").serializeJSON(),\n                forcedEmail: forcedEmail,\n                session: springySessionId,\n                bookings: preparePendingBookingsPayload(),\n                returnUrl: springyPage.returnUrl.length > 0 ? springyPage.returnUrl : window.location.href,\n                pickupHolds: jQuery(\'#s-lc-pickup-holds\').val(),\n            };\n\n            springySpaces.stopSessionTimer();\n            pageBusyBegin("#btn-form-submit");\n\n            jQuery.ajax({\n                type: "post",\n                url: "/ajax/space/book",\n                data: payload,\n                dataType: "json",\n            })\n            .always(function (data) {\n                pageBusyEnd("#btn-form-submit");\n            })\n            .done(function(data) {\n                if (data.error) {\n                    jQuery("#s-lc-eq-errors").html(data.error).show();\n                    return;\n                }\n\n                jQuery(\'#s-lc-eq-form, .s-lc-spaces-setup-info\').hide();\n                jQuery("#s-lc-eq-success-content").html(data.html)\n                jQuery("#s-lc-eq-success").show().focus();\n            })\n            .fail(ajaxErrorHandler);\n\n            return false;\n        }\n\n        function submitPendingTimes() {\n            var payload = {\n                session: springySessionId,\n                patron: springySpaces.patron,\n                patronHash: springySpaces.patronHash,\n                bookings: preparePendingBookingsPayload(),\n            };\n\n            springySpaces.stopSessionTimer();\n            pageBusyBegin("#submit_times");\n\n            jQuery.ajax({\n                type: \'post\',\n                url: "/ajax/space/times",\n                data: payload,\n                dataType: "html",\n            })\n            .always(function (data) {\n                pageBusyEnd("#submit_times");\n            })\n            .done(function(data) {\n                // hide a bunch of stuff\n                jQuery(\'.s-lc-spaces-setup-info\').hide();\n\n                // setup booking form + terms html\n                jQuery("#s-lc-eq-form").html(data).show();\n\n                // scroll to the top of the page\n                window.scrollTo(0, 0);\n\n                springySpaces.startSessionTimer();\n            })\n            .fail(ajaxErrorHandler);\n\n            return false;\n        }\n\n        function submitPendingRoomBookings_LibAuth() {\n            var payload = {\n                libAuth: true,\n                blowAwayCart: true,\n                session: springySessionId,\n                bookings: preparePendingBookingsPayload(),\n            };\n\n            springySpaces.stopSessionTimer();\n            workingAlert();\n\n            jQuery.ajax({\n                type: \'post\',\n                url: "/ajax/space/createcart",\n                data: payload,\n                dataType: \'json\',\n            })\n            .always(function (data) {\n                stopAlert();\n            })\n            .done(function(data) {\n                if (data.success) {\n                    // redirect to libauth checkout page\n                    window.location = data.redirect;\n                } else {\n                    jQuery("#s-lc-eq-errors").html(data.error).show();\n                }\n            })\n            .fail(ajaxErrorHandler);\n\n            return false;\n        }\n\n        function makeCartAndGoToEquipPage() {\n            // we only allow user to do this if all the room bookings start at the same time\n            if (pendingRoomBookings.length > 1) {\n                var startTime = pendingRoomBookings[0].start;\n                for (var i = 1; i < pendingRoomBookings.length; i++) {\n                    var bookingInfo = pendingRoomBookings[i];\n                    if (!bookingInfo.start.isSame(startTime)) {\n                        errorAlert(\'You can only create an Equipment Cart if all your room bookings begin at the same time.\');\n                        return false;\n                    }\n                }\n            }\n\n            var payload = {\n                blowAwayCart: pendingBookingsBlowAwayCart,\n                session: springySessionId,\n                bookings: preparePendingBookingsPayload(),\n            };\n\n            springySpaces.stopSessionTimer();\n            workingAlert();\n\n            jQuery.ajax({\n                type: \'post\',\n                url: "/ajax/space/createcart",\n                data: payload,\n                dataType: \'json\',\n            })\n            .always(function (data) {\n                stopAlert();\n            })\n            .done(function(data) {\n                if (data.success) {\n                    // redirect to new page\n                    window.location = data.redirect;\n                } else if (data.hasItems) {\n                    errorAlert("Cart already has items in it. If you click the shopping cart again, the existing items in the cart will be replaced by the selected rooms.");\n                    pendingBookingsBlowAwayCart = true;\n                } else {\n                    errorAlert(data.error);\n                }\n            })\n            .fail(ajaxErrorHandler);\n\n            return false;\n        }\n\n        function changeBookingTimes() {\n            // show the old form box + availability grid\n            jQuery(\'.s-lc-spaces-setup-info\').show();\n\n            // hide the terms + booking form\n            jQuery(\'#s-lc-eq-form, #s-lc-eq-errors\').hide();\n\n            return false;\n        }\n\n        function doEventsContainAnyAvailabileSlots(events) {\n            for (var i=0; i < events.length; i++) {\n                if (events[i].classNames.indexOf(\'s-lc-eq-avail\') >= 0) {\n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n        function onRenderSpaceResource(resource, element) {\n            var html = \'<span class="fc-expander-space"><span class="fc-icon"></span></span>\';\n            var resourceData = resource.extendedProps;\n            var resourceId = springyPage.isSeatBooking ? resourceData.seatId : resourceData.eid;\n            var title  = escapeHtml(resource.title);\n\n            if (resourceData.hasInfo) {\n                html += \'<a href="#" class="s-lc-item-more-info" data-eid="\' + resourceId + \'"\' +\n                    \' aria-label="Click\\u0020for\\u0020more\\u0020info\\u0020about \' + title + \'">\' +\n                    \'<span class="s-lc-info-label">Info</span>\' +\n                    \'</a>\';\n            }\n\n            var additionalClasses = \'\';\n            var additionalIcons = \'\';\n\n            if (resourceData.isAccessible) {\n                additionalClasses += \' s-lc-accessible\';\n                additionalIcons += \' <i class="fa fa-wheelchair-alt fa-lg" aria-hidden="true"></i>\';\n            }\n\n            if (resourceData.isPowered) {\n                additionalClasses += \' s-lc-powered\';\n                additionalIcons += \' <i class="fa fa-plug fa-lg" aria-hidden="true"></i>\';\n            }\n\n            var resourceLabel = \'<span class="fc-cell-text\' + additionalClasses + \'">\' + title + additionalIcons + \'</span>\';\n\n            if (resourceData.url !== undefined) {\n                html += \'<a href="\' + resourceData.url + \'">\' + resourceLabel + \'</a>\';\n            } else {\n                html += resourceLabel;\n            }\n\n            jQuery(element).html(html);\n        }\n\n        jQuery(function () {\n            jQuery(\'#lid\').on(\'change\', goToPageForLocation);\n            jQuery(\'#gid\').on(\'change\', goToPageForGroup);\n\n            jQuery(\'#s-lc-session-warning-continue\').on(\'click\', springySpaces.updateSession);\n            jQuery(\'#s-lc-session-expired-reload\').on(\'click\', function() {\n                window.location.reload();\n\n                return false;\n            });\n\n            jQuery(\'#eq_cart\').on(\'click\', makeCartAndGoToEquipPage);\n\n            jQuery(\'#s-lc-eq-form-times\').on(\'submit\', function() {\n                if (locationIsUsingLibAuth) {\n                    return submitPendingRoomBookings_LibAuth();\n                }\n\n                return submitPendingTimes();\n            });\n        });\n    </script>\n\n\n    <script src="/js617/direct/pagination.min.js"></script>\n    <script src="/js617/direct/public/equipment/spaces-standard.min.js"></script>\n        <script>\n        var springyPage = {\n            wantAlternatingBackground: false,\n            timelineOptions: {\n                resourceAreaWidth: \'33%\',\n            },\n            locationId: 1642,\n            groupId: 3007,\n            itemId: -1,\n            isSeatBooking: 0,\n            seatId: 0,\n            zoneId: 0,\n            isAccessible: 0,\n            isPowered: 0,\n            resourceRows: 2,\n            additionalLegends: \'\\u003Cspan\\u0020class\\u003D\\u0022label\\u002Deq\\u002Dcont\\u0022\\u0020data\\u002Dtoggle\\u003D\\u0022tooltip\\u0022\\u0020data\\u002Dplacement\\u003D\\u0022top\\u0022\\u0020title\\u003D\\u0022Slot\\u0020is\\u0020available,\\u0020click\\u0020to\\u0020book\\u0021\\u0022\\u003E\\u003Cspan\\u0020class\\u003D\\u0022label\\u0020label\\u002Deq\\u002Davail\\u0022\\u003E\\u0026nbsp\\u003B\\u0026nbsp\\u003B\\u003C\\/span\\u003E\\u0020Available\\u003C\\/span\\u003E\\n\\u003Cspan\\u0020class\\u003D\\u0022label\\u002Deq\\u002Dcont\\u0022\\u0020data\\u002Dtoggle\\u003D\\u0022tooltip\\u0022\\u0020data\\u002Dplacement\\u003D\\u0022top\\u0022\\u0020title\\u003D\\u0022Your\\u0020pending\\u0020booking.\\u0022\\u003E\\u003Cspan\\u0020class\\u003D\\u0022label\\u0020label\\u002Deq\\u002Dpending\\u0022\\u003E\\u0026nbsp\\u003B\\u0026nbsp\\u003B\\u003C\\/span\\u003E\\u0020Your\\u0020Booking\\u003C\\/span\\u003E\\n\\u003Cspan\\u0020class\\u003D\\u0022label\\u002Deq\\u002Dcont\\u0022\\u0020data\\u002Dtoggle\\u003D\\u0022tooltip\\u0022\\u0020data\\u002Dplacement\\u003D\\u0022top\\u0022\\u0020title\\u003D\\u0022This\\u0020slot\\u0020is\\u0020unavailable\\u0020for\\u0020starting\\u0020a\\u0020new\\u0020booking.\\u0020Bookings\\u0020may\\u0020occasionally\\u0020extend\\u0020into\\u0020this\\u0020slot.\\u0022\\u003E\\u003Cspan\\u0020class\\u003D\\u0022label\\u0020label\\u002Deq\\u002Dunavailable\\u0022\\u003E\\u0026nbsp\\u003B\\u0026nbsp\\u003B\\u003C\\/span\\u003E\\u0020Unavailable\\/Padding\\u003C\\/span\\u003E\',\n            resourceColumnLabel: \'Space\',\n            viewMode: \'timelineSingleDay\',\n            returnUrl: \'\',\n            capacitySeatValue: -1,\n            pageIndex: 0,\n            pageSize: 18,\n        };\n\n        var resources = [];\n        var resourceNameIdMap = [];\n\n                                                                                                                    resources.push({\n    id: "eid_12089",\n    title: "VB\\u00201.09 (Capacity 2)",\n    url: "/space/12089",\n    eid: 12089,\n    gid: 3007,\n    lid: 1642,\n    grouping: "Group\\u0020room",\n    gtype: 2,\n    gBookingSelectableTime: false,\n    capacity: 2,\n    hasInfo: false,\n    thumbnail: "",\n    isAccessible: 1,\n    isPowered: 0,\n});\n\nresourceNameIdMap["eid_12089"] = "VB\\u00201.09";                                    resources.push({\n    id: "eid_10621",\n    title: "VB\\u00202.12 (Capacity 4)",\n    url: "/space/10621",\n    eid: 10621,\n    gid: 3007,\n    lid: 1642,\n    grouping: "Group\\u0020room",\n    gtype: 2,\n    gBookingSelectableTime: false,\n    capacity: 4,\n    hasInfo: false,\n    thumbnail: "",\n    isAccessible: 1,\n    isPowered: 0,\n});\n\nresourceNameIdMap["eid_10621"] = "VB\\u00202.12";                                    \n        \n        var paginatedResources = springySpaces.createPaginatedResources(resources, springyPage.pageSize);\n\n        var capacityRangesMap = {};\n                                capacityRangesMap[0] = {\n                min: 0,\n                max: 9223372036854775807\n            };\n                                capacityRangesMap[1] = {\n                min: 0,\n                max: 4\n            };\n                                capacityRangesMap[2] = {\n                min: 5,\n                max: 8\n            };\n                                capacityRangesMap[3] = {\n                min: 9,\n                max: 12\n            };\n                                capacityRangesMap[4] = {\n                min: 13,\n                max: 9223372036854775807\n            };\n        \n        var resourceSettings = createResourceSettings(1);\n\n        springyPage.resourceCount = resources.length;\n    </script>\n    \n    <script>\n    var springySessionId = 0;\n    var pendingBookingsLimitIssues = null;\n    var dateFormatStartTimeDict = "MMDDHHmm";\n    var dateFormatDayOfYear = "YYYY-MM-DD";\n    var issueTypeAdditionalText = {\n        "duration": " minutes",\n        "frequency": " bookings",\n    };\n    var frequencyDisplayStrings = {\n        "d": " per\\u0020day",\n        "w": " per\\u0020week",\n        "m": " per\\u0020month",\n        "y": " per\\u0020year",\n        "t": " at\\u0020a\\u0020time",\n    };\n\n    function pendingRoomBookingsAreNowEmpty() {\n        jQuery("#s-lc-eq-form-box").hide();\n    }\n\n    function renderPendingRoomBookings(fcInstance) {\n        // ensure all tooltips are hidden\n        jQuery(".tooltip").hide();\n\n        if (pendingRoomBookings.length == 0) {\n            pendingRoomBookingsAreNowEmpty();\n            return;\n        }\n\n        // refresh the shown cart items\n        // format the room data as html\n        var html = \'<div>\';\n        var dateTimeFormat = springSpace.getDateTimeFormat();\n        var shortDateTimeFormat = springSpace.getShortDateTimeFormat();\n        var totalCost = 0;\n\n        for (var i = 0; i < pendingRoomBookings.length; i++) {\n            var bookingInfo = pendingRoomBookings[i];\n            var bookingCost = bookingInfo.cost;\n            var resourceId = bookingInfo.seat_id > 0 ? bookingInfo.seat_id : bookingInfo.eid;\n            var resourceName = resourceNameIdMap[\'eid_\' + resourceId];\n\n            html += \'<div class="form-group s-lc-pending-booking" id="pending_booking_\' + bookingInfo.id + \'">\';\n            html += \'   <label class="col-md-5 control-label" for="bookingend_\' + bookingInfo.id + \'"><strong>\' + resourceName + \'</strong>: \' + bookingInfo.start.format(dateTimeFormat) + \' \' + springLang.eq_js_until_det + \'</label>\';\n            html += \'   <div class="col-md-3">\';\n            html += \'     <div class="input-group">\';\n            html += \'           <select id="bookingend_\' + bookingInfo.id + \'" name="bookingend_\' + bookingInfo.id + \'" data-booking="\' + bookingInfo.id + \'" class="form-control input-sm b-end-date">\';\n\n            for (var selectionIndex = 0; selectionIndex < bookingInfo.options.length; selectionIndex++) {\n                var selected = bookingInfo.optionSelected == selectionIndex ? \'selected="selected"\' : \'\';\n                var value = bookingInfo.options[selectionIndex];\n                var name = moment(value).format(shortDateTimeFormat);\n                var checksum = bookingInfo.optionChecksums[selectionIndex];\n                html += \'<option value="\' + value + \'" \' + selected + \' data-crc="\' + checksum + \'">\' + name + \'</option>\';\n            }\n\n            html += \'           </select>\';\n            html += \'           <div class="input-group-btn">\';\n            html += \'               <button type="button" class="btn btn-default btn-sm" onclick="return removePendingBooking(\' + bookingInfo.id + \',\' + bookingInfo.lid + \');"><i class="fa fa-trash-o" aria-hidden="true"></i><span class="sr-only">\' + springLang.eq_js_rem_pending + \'</span></button>\';\n            html += \'           </div>\';\n            html += \'       </div>\';\n            html += \'     </div>\';\n            if (bookingCost > 0) {\n                var costDisplay = springSpace.formatCurrency(bookingCost);\n                var costPreview = "\\u007Bamount\\u007D".replace("\\u007Bamount\\u007D", costDisplay).replace("\\u007Brate\\u007D", "");\n                html += \'<label class="col-md-3 control-label s-lc-billing-cost-single">\' + costPreview + \'</label>\';\n            }\n            html += \'   </div>\';\n            html += \'   </div>\';\n            html += \'</div>\';\n\n            totalCost += bookingCost;\n        }\n\n        var bookingDurationOkay = true;\n        if (pendingBookingsLimitIssues) {\n            bookingDurationOkay = false;\n            pendingBookingsLimitIssues.forEach(function(issueDetails) {\n                var limitDisplay = issueDetails.allowed + issueTypeAdditionalText[issueDetails.type] + frequencyDisplayStrings[issueDetails.frequency];\n                var usedDisplay = issueDetails.used + issueTypeAdditionalText[issueDetails.type];\n                var issueDisplay = \'Sorry,\\u0020you\\u0020can\\u0020only\\u0020reserve\\u0020\\u007BlimitAmount\\u007D,\\u0020and\\u0020you\\u0020currently\\u0020have\\u0020\\u007BusedAmount\\u007D.\\u0020Please\\u0020adjust\\u0020your\\u0020booking.\'.replace(\'{limitAmount}\', limitDisplay).replace(\'{usedAmount}\', usedDisplay);\n                var issueHtml = \'<strong>\' + issueDetails.group + \'</strong>: \' + issueDisplay;\n\n                html += \'\\\n                    <div class="form-group">\\\n                        <div class="col-md-offset-1 col-md-10">\\\n                            <div class="alert alert-warning">\' + issueHtml + \'</div>\\\n                        </div>\\\n                    </div>\';\n            });\n        }\n\n        if (totalCost > 0) {\n            html += \'\\\n                <div class="form-group s-lc-pending-booking">\\\n                    <label class="col-md-5 control-label">Total\\u0020cost\\u0020for\\u0020this\\u0020reservation\\u003A</label>\\\n                    <label class="col-md-5 control-label s-lc-billing-cost-total">\' + springSpace.formatCurrency(totalCost) + \'</label>\\\n                </div>\';\n        }\n\n        html += \'</div>\';\n\n        // show the booking form box which contains the booking well, the terms + conditions and the booking form\n        jQuery("#s-lc-eq-form-box").show();\n\n        // put the item in the displayed cart + set the window focus to the cart\n        var roomCart = jQuery("#s-lc-eq-bwell");\n        roomCart.empty();\n        roomCart.html(html);\n        roomCart.focus();\n\n        // disable the add equipment and form submission buttons until the times are okay\n        jQuery("#submit_times, #eq_cart").prop(\'disabled\', !bookingDurationOkay);\n\n        // setup delete icon tooltips\n        accessibleIcons();\n\n        // make the tooltip for the cart icon\n        jQuery("#eq_cart").tooltip({\n            title: springLang.eq_js_cart_tt,\n            html: true,\n            container: "body"\n        });\n\n        jQuery(\'.b-end-date\').on(\'change\', function() {\n            var changedBooking = jQuery(this);\n\n            updatePendingBookingDuration(changedBooking, fcInstance);\n        });\n    }\n\n    function preparePendingBookingsPayload() {\n        var payload = [];\n\n        for (var i = 0; i < pendingRoomBookings.length; i++) {\n            var bookingInfo = pendingRoomBookings[i];\n            payload.push({\n                id: bookingInfo.id,\n                eid: bookingInfo.eid,\n                seat_id: bookingInfo.seat_id,\n                gid: bookingInfo.gid,\n                lid: bookingInfo.lid,\n                start: bookingInfo.start.format(springSpace.phpDateTimeFormat),\n                end: bookingInfo.end.format(springSpace.phpDateTimeFormat),\n                checksum: bookingInfo.checksum,\n            });\n        }\n        return payload;\n    }\n\n    function pendingRoomBookingsUpdateListAndAvailability(payload, fcInstance) {\n        // if we are adding rooms, we might need to hide the previous booking success message\n        jQuery("#s-lc-eq-success").hide();\n\n        springySpaces.stopSessionTimer();\n        workingAlert();\n\n        // find out booking information\n        jQuery.ajax({\n            type: "post",\n            url: "/spaces/availability/booking/add",\n            data: payload,\n            dataType: "json",\n        })\n        .always(stopAlert)\n        .done(function(data) {\n            if (data.error) {\n                if (data.isRefreshRequired) {\n                    fcInstance.refetchEvents();\n                }\n\n                return errorAlert(data.error);\n            }\n\n            // success! the entire pending bookings array can be re-created now\n            pendingRoomBookings = [];\n            pendingBookingsLimitIssues = data.limitIssues;\n            springySessionId = data.session;\n            springySpaces.startSessionTimer();\n\n            for (var i = 0; i < data.bookings.length; i++) {\n                var booking = data.bookings[i];\n\n                pendingRoomBookings.push({\n                    id: booking.id,\n                    eid: booking.eid,\n                    seat_id: booking.seat_id,\n                    gid: booking.gid,\n                    lid: booking.lid,\n                    cost: booking.cost,\n                    checksum: booking.checksum,\n\n                    name: booking.name,\n                    start: moment(booking.start),\n                    end: moment(booking.end),\n\n                    options: booking.options,\n                    optionSelected: booking.optionSelected,\n                    optionChecksums: booking.optionChecksums,\n                });\n            }\n\n            // this request might have came back with updated grid data\n            // if it did not - refresh the whole grid\n            if (data.gridUpdateData) {\n                updateGridEventsForItem(data.gridUpdateData, fcInstance);\n            } else if (fcInstance) {\n                fcInstance.refetchEvents();\n            }\n\n            renderPendingRoomBookings(fcInstance);\n        })\n        .fail(ajaxErrorHandler);\n\n        return false;\n    }\n\n    function createStartTimeToClassMap(gridData) {\n        var startTimeToClassMap = {};\n\n        gridData.forEach(function(gridElement) {\n            var startMoment = moment(gridElement.start);\n            startTimeToClassMap[startMoment.format(dateFormatStartTimeDict)] = [gridElement.className];\n        });\n\n        return startTimeToClassMap;\n    }\n\n    function updateGridEventsForItem(gridUpdateData, fcInstance) {\n        var changedItemId = gridUpdateData.itemId;\n        var changedRangeStart = moment(gridUpdateData.dateStart, springSpace.phpDateTimeFormat);\n        var changedRangeEnd = moment(gridUpdateData.dateEnd, springSpace.phpDateTimeFormat);\n        var startTimeToClassMap = createStartTimeToClassMap(gridUpdateData.gridData);\n\n        fcInstance.batchRendering(function() {\n            fcInstance.getEvents().forEach(function (clientEvent) {\n                if (clientEvent.extendedProps.itemId !== changedItemId) {\n                    return;\n                }\n\n                var clientEventStart = moment(clientEvent.start);\n                // if this event is before the day of events that was changed - forget it\n                // and we only want to process events that start before the changed range "end"\n                if (clientEventStart.isBefore(changedRangeStart) || !clientEventStart.isBefore(changedRangeEnd)) {\n                    return;\n                }\n\n                var startKey = clientEventStart.format(dateFormatStartTimeDict);\n                if (startKey in startTimeToClassMap) {\n                    // this slot is unavailable\n                    clientEvent.setProp(\'classNames\', startTimeToClassMap[startKey]);\n                    clientEvent.setExtendedProp(\'status\', 1);\n                } else {\n                    // this slot is available\n                    clientEvent.setProp(\'classNames\', ["s-lc-eq-avail"]);\n                    clientEvent.setExtendedProp(\'status\', 0);\n                }\n            });\n        });\n    }\n\n    function timeGridClickedOnAvailableRoom(calEvent, fcInstance) {\n        var resource = calEvent.getResources()[0];\n        var resourceData = resource.extendedProps;\n        var timeslotData = calEvent.extendedProps;\n        var view = fcInstance.view;\n\n        var payload = {\n            add: {\n                eid: resourceData.eid,\n                seat_id: resourceData.seatId,\n                gid: resourceData.gid,\n                lid: resourceData.lid,\n                start: moment(calEvent.start).format(springSpace.phpDateTimeFormat),\n                checksum: timeslotData.checksum,\n            },\n                        lid: 1642,\n            gid: 3007,\n                        start: moment(view.activeStart).format(dateFormatDayOfYear),\n            end: moment(view.activeEnd).format(dateFormatDayOfYear),\n            session: springySessionId,\n            bookings: preparePendingBookingsPayload(),\n        }\n\n        return pendingRoomBookingsUpdateListAndAvailability(payload, fcInstance);\n    }\n\n    function updatePendingBookingDuration(changedBooking, fcInstance) {\n        var view = fcInstance.view;\n        var selectedElement = changedBooking.find(\':selected\');\n\n        var payload = {\n            update: {\n                id: changedBooking.data(\'booking\'),\n                checksum: selectedElement.data(\'crc\'),\n                end: changedBooking.val()\n            },\n                        lid: 1642,\n            gid: 3007,\n                        start: moment(view.activeStart).format(dateFormatDayOfYear),\n            end: moment(view.activeEnd).format(dateFormatDayOfYear),\n            session: springySessionId,\n            bookings: preparePendingBookingsPayload(),\n        }\n\n        return pendingRoomBookingsUpdateListAndAvailability(payload, fcInstance);\n    }\n\n    function removePendingBooking(pendingId, locationId) {\n        var timeline = getCurrentTimelineInstance(locationId);\n        var view = timeline.view;\n\n        var payload = {\n            removeId: pendingId,\n                        lid: 1642,\n            gid: 3007,\n                        start: moment(view.activeStart).format(dateFormatDayOfYear),\n            end: moment(view.activeEnd).format(dateFormatDayOfYear),\n            session: springySessionId,\n            bookings: preparePendingBookingsPayload(),\n        }\n\n        return pendingRoomBookingsUpdateListAndAvailability(payload, timeline);\n    }\n\n    function formatEventsForFullCalendar(events) {\n        events.forEach(function(eventData) {\n            eventData.resourceId = "eid_" + eventData.itemId;\n\n            if (eventData.className) {\n                // this slot is unavailable\n                eventData.status = 1;\n                eventData.classNames = [eventData.className];\n            } else {\n                // this slot is available\n                eventData.classNames = ["s-lc-eq-avail"];\n                eventData.status = 0;\n            }\n        });\n\n        return events;\n    }\n\n    function timeGridRoomFetchEventsForTimePeriod(start, end, callback, lid, gid, eid) {\n        jQuery.ajax({\n            type: "post",\n            url: "/spaces/availability/grid",\n            data: {\n                lid: lid,\n                gid: gid,\n                eid: eid,\n                seat: springyPage.isSeatBooking,\n                seatId: springyPage.seatId,\n                zone: springyPage.zoneId,\n                accessible: springyPage.isAccessible,\n                powered: springyPage.isPowered,\n                start: moment(start).format(dateFormatDayOfYear),\n                end: moment(end).format(dateFormatDayOfYear),\n                bookings: preparePendingBookingsPayload(),\n                pageIndex: springyPage.pageIndex,\n                pageSize: springyPage.pageSize,\n            },\n            dataType: "json",\n        })\n        .done(function(events) {\n            callback(formatEventsForFullCalendar(events));\n\n            var hasAvailability = doEventsContainAnyAvailabileSlots(events);\n\n                                        jQuery(".fc-goToNextAvailable-button").toggle(!hasAvailability);\n                    })\n        .fail(function(xhr) {\n            // let fullcalendar know that the request has completed with no results\n            callback([]);\n\n            // and display the error to the user\n            ajaxErrorHandler(xhr);\n        });\n    }\n</script>\n\n    \n\n</body>\n</html>'