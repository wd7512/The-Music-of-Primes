var LoggingClientManager=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=t.UNCAUGHT_ERROR="uncaughtError",o=t.CREATIVE_LOAD_LATENCY="creativeLoadLatency",a=t.VISUAL_COMPLETENESS_LATENCY="visualCompletenessLatency",s=function(){function e(t){if(function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.events=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,{}),this.timers={},this.onNewError=function(){},this.window=t&&t.window||"undefined"!=typeof window&&window,!this.window||!this.window.document)throw new Error("Window and/or document is not defined");this.trackLoadLatency(),this.trackVisualCompletenessLatency(),this.addErrorListener()}return i(e,[{key:"trackLoadLatency",value:function(){this.timers[o]=new Date}},{key:"trackVisualCompletenessLatency",value:function(){this.timers[a]=new Date}},{key:"addErrorListener",value:function(){var e=this,t=this.events[r];this.addListener(this.window,"error",function(n){var i=n.message;if(n.error&&n.error.stack){var r=n.message+" : "+n.error.stack;i=r.length<500?r:r.substring(0,500)}void 0===t[i]&&(t[i]=!0,e.onNewError(i))})}},{key:"addListener",value:function(e,t,n){var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return n(e)};if(e.addEventListener)e.addEventListener(t,i,!0);else if(t="on"+t,e.attachEvent)e.attachEvent(t,i);else{var r=e[t];e[t]=function(){i.apply(this,arguments),"function"==typeof r&&r.apply(this,arguments)}}}}]),e}();t.default=s},function(e,t,n){"use strict";n.r(t);var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function r(e,t){var n=o(t),i=function(e){return e.innerWidth||e.document.documentElement.clientWidth}(t),r=e.getBoundingClientRect(),s=a(r.top,r.bottom,n)*a(r.left,r.right,i),u=(r.bottom-r.top)*(r.right-r.left);return Math.min(1,Math.max(0,s/u))}function o(e){return e.innerHeight||e.document.documentElement.clientHeight}function a(e,t,n){var i;return i=e>0?n-e:t>0?Math.min(t,n):0,Math.min(i,t-e)}var s=function(){function e(t,n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.window=n||window,this.elem=t}return i(e,[{key:"getPercentInView",value:function(){var e=this.getTopWindow();if(e){if(this.window===e)return r(this.elem,e);if(this.window.frameElement)return r(this.window.frameElement,e)}else if(this.window.$sf)try{return(this.window.$sf.ext.inViewPercentage()||0)/100}catch(e){}return-1}},{key:"getTopWindow",value:function(){return function(e){if(!e)throw new Error("window argument required");if("boolean"==typeof e.dacxIsCrossOrigin)return e.dacxIsCrossOrigin;try{if(!e.top.document)throw new Error("cross-domain exception");e.dacxIsCrossOrigin=!1}catch(t){e.dacxIsCrossOrigin=!0}return e.dacxIsCrossOrigin}(this.window)?null:this.window.top}},{key:"onViewThreshold",value:function(e,t,n,i){var r=this,o=null;return function(a){var s=null;return function a(){(function(){if(r.getPercentInView()>=e&&r.getPercentInView()<=t){var a=(new Date).getTime();if(null===o)o=a;else if(a-o>n)return i(),!0}else o=null})()||(s=setTimeout(a,100))}(),{clear:function(){s&&clearTimeout(s)}}}()}},{key:"onView",value:function(e,t,n){return this.onViewThreshold(e,1,t,n)}},{key:"onHide",value:function(e,t,n){return this.onViewThreshold(0,e,t,n)}},{key:"getVerticalPositionOnPage",value:function(){var e=-1,t=this.getTopWindow();if(t)if(this.window===t){var n=this.elem.getBoundingClientRect().top,i=o(t),r=this.elem.getBoundingClientRect().height;e=Math.max(Math.min(n/(i-r),1),0)}else this.window.frameElement&&(n=this.window.frameElement.getBoundingClientRect().top,i=o(t),r=this.window.frameElement.getBoundingClientRect().height,e=Math.max(Math.min(n/(i-r),1),0));else if(this.window.$sf)try{e=Math.max(Math.min($sf.ext.geom().self.t/($sf.ext.geom().win.h-$sf.ext.geom().self.h),1),0)}catch(e){}return e}}]),e}();t.default=s},function(e,t,n){"use strict";n.r(t);var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),"object"===(void 0===t?"undefined":r(t))?this.configure(t):this.oldConfig.apply(this,arguments)}return o(e,[{key:"oldConfig",value:function(e,t,n,i){this.configure({renderId:e,isDebug:t,stage:n,market:i})}},{key:"configure",value:function(e){var t=e.sampleRate,n=e.batchTimeout,r=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["sampleRate","batchTimeout"]);n="number"==typeof n?n:50,this.enabled="number"!=typeof t||Math.random()<t,i(this,r),this.bufferedMetrics=[],this.timers={},this.setCemEndpoint(),this.setDebouncedLogBatchMetrics(n)}},{key:"setCemEndpoint",value:function(){var e=function(e,t){if(!e||!t)throw new Error("aan endpoint could not be identified. All arguments are required: "+JSON.stringify({stage:e,market:t})+".");var n=function(e){switch(t){case"US":case"CA":case"MX":case"BR":return"na";case"UK":case"DE":case"FR":case"IT":case"ES":case"IN":case"AE":case"NL":case"SA":return"eu";case"JP":case"AU":case"SG":return"fe";case"CN":return"cn"}}();switch(e){case"prod":var i="amazon."+function(e){switch(e){case"US":return"com";case"MX":return"com.mx";case"UK":return"co.uk";case"JP":return"co.jp";case"AU":return"com.au";case"AE":return"ae";case"SA":return"sa";case"BR":return"com.br";case"NL":return"nl";case"SG":return"sg";default:return e.toLowerCase()}}(t);return"na"===n&&(i="amazon.com"),"https://aan."+i;case"gamma":return"https://aan-internal-"+("na"===n?"":n+"-")+"gamma.amazon.com";default:return"https://aan-internal.vipinteg.amazon.com"}}(this.stage,this.market||"US");this.cemEndpoint=e+"/cem"}},{key:"setDebouncedLogBatchMetrics",value:function(e){var t=this;this.debouncedLogBatchMetrics=function(e,n){var i=void 0;return function(){var e=this,r=arguments;clearTimeout(i),i=setTimeout(function(){return function(){if(Object.keys(t.bufferedMetrics).length){var e=t.prepareBatchedMetrics();t.isDebug?(console.log("[DEBUG] Logging "+t.bufferedMetrics.length+" metrics:"),t.bufferedMetrics.forEach(function(e){console.log("- [DEBUG] Metric "+e.dimensions.subtype+" with dimensions:"),console.log(metrics.dimensions)})):t.postMetrics(e)}}.apply(e,r)},n)}}(0,e)}},{key:"postMetrics",value:function(e){this.enabled&&function(e,t){if("undefined"!=typeof XMLHttpRequest){var n=new XMLHttpRequest;n.onerror=function(e){console.error("Failure posting to CEM: "+e)},n.open(t.method||"POST",e,!0);var i=t.headers||{};for(var r in i)n.setRequestHeader(r,i[r]);n.send(t.body)}}(this.cemEndpoint,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}},{key:"startTimer",value:function(e){this.timers[e]=new Date}},{key:"endTimer",value:function(e,t){if(this.timers[e]){var n=new Date-this.timers[e];this.logPerformanceEvent(e,n,t),delete this.timers[e]}}},{key:"batchMetric",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.bufferedMetrics[e],r=i({},t,{template_name:this.templateName});Array.isArray(n)?n.push(r):this.bufferedMetrics[e]=[r],this.logBatchedMetrics()}},{key:"prepareBatchedMetrics",value:function(){var e=this;return Object.keys(this.bufferedMetrics).map(function(t){return{event_type:t,render_id:e.renderId,dimensions:e.bufferedMetrics[t]}})}},{key:"logBatchedMetrics",value:function(){this.debouncedLogBatchMetrics()}},{key:"logMetric",value:function(e,t){var n=i({},t,{template_name:this.templateName});if(this.isDebug)console.log("[DEBUG] Logging metric for "+t.subtype+" with dimensions:"),console.log(t);else{var r={render_id:this.renderId,event_type:e,dimensions:n||{}};this.postMetrics(r)}}},{key:"doLogging",value:function(e,t,n){(n?this.batchMetric:this.logMetric).call(this,e,t)}},{key:"doLogImpression",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.doLogging("impression",i({subtype:"impression",value:1},e),t)}},{key:"logImpression",value:function(e){this.doLogImpression(e)}},{key:"logBatchedImpression",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.doLogImpression(e,!0)}},{key:"doLogEvent",value:function(e,t){var n=e.eventName,r=e.eventType,o=e.componentType,a=e.componentName,s=e.eventValue,u=void 0===s?1:s,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.doLogging(r,i({component_type:o,component_name:a,subtype:n,value:u},t),c)}},{key:"logEvent",value:function(e){this.doLogEvent(e)}},{key:"logBatchedEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.doLogEvent(e,t,!0)}},{key:"doLogPerformanceEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.doLogging("performance",i({subtype:e,value:t||1,userAgent:navigator&&navigator.userAgent},n),r)}},{key:"logPerformanceEvent",value:function(e,t,n){this.doLogPerformanceEvent(e,t,n)}},{key:"logBatchedPerformanceEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.doLogPerformanceEvent(e,t,n,!0)}}]),e}();t.default=a},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,n){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.timer=null,this.initializeEvents(t),this.latencies={},this.suppressEventLogging=n,this.isComplete=!1,this.handleTimeout()}return i(e,[{key:"initializeEvents",value:function(e){var t=this;this.events={},e.forEach(function(e){return t.addTimer(e)})}},{key:"handleTimeout",value:function(){var e=this;this.timeout=setTimeout(function(){e.clearInvalidTimers(),e.logEvents()},2500)}},{key:"startTimer",value:function(e){this.timer=e}},{key:"endTimer",value:function(e){if(null===this.timer)throw new Error("You must call startTimer() before calling endTimer()");void 0!==this.events[e]&&0!==this.events[e]&&(this.events[e]--,0===this.events[e]&&(this.latencies[e]=new Date-this.timer,this.validateComplete()))}},{key:"addTimer",value:function(e){void 0===this.events[e]&&(this.events[e]=0),this.events[e]++}},{key:"skipTimer",value:function(e){void 0!==this.events[e]&&0!==this.events[e]&&(this.events[e]--,0===this.events[e]&&void 0===this.latencies[e]&&delete this.events[e],0===this.events[e]&&this.validateComplete())}},{key:"clearInvalidTimers",value:function(){var e=this;Object.keys(this.events).forEach(function(t){void 0===e.latencies[t]&&delete e.events[t]})}},{key:"validateComplete",value:function(){var e=this;this.isComplete=Object.keys(this.events).every(function(t){return void 0!==e.latencies[t]}),this.isComplete&&this.logEvents()}},{key:"logEvents",value:function(){var e=this;clearTimeout(this.timeout);var t=new Date-this.timer;window&&window.CemLogger&&!this.suppressEventLogging&&(Object.keys(this.events).forEach(function(t){window.CemLogger.logBatchedPerformanceEvent(t+"Latency",e.latencies[t])}),this.isComplete?window.CemLogger.logBatchedPerformanceEvent("visualCompleteness",t):window.CemLogger.logMetric("visualCompleteness",{subtype:"visualCompletenessFailure",value:1}))}}]),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CEM_LOGGER_METRICS={EVENT_TYPES:{VIEWABILITY:"viewability",CLICK_THROUGH:"click_through"},EVENT_NAMES:{AAN_LATENCY:"aanLatency",AAN_ERROR:"aanError",UNCAUGHT_ERROR:"uncaughtError",CREATIVE_LOAD_LATENCY:"creativeLoadLatency",IN_VIEW:"inView",VIEWABILITY_FAILURE:"viewabilityFailure",CREATIVE_CLICK:"creativeClick",NAVIGATION_ATTEMPT:"navigationAttempt",NAVIGATION_ERROR:"navigationError",NAVIGATION_INFO:"navigationInfo"},COMPONENT_TYPES:{CREATIVE:"creative"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=c(n(2)),o=c(n(1)),a=n(5),s=c(n(4)),u=n(0);function c(e){return e&&e.__esModule?e:{default:e}}var l=.05,f=.5,d=function(){function e(t,n){if(function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.window=t.window||"undefined"!=typeof window&&window,!this.window||!this.window.document)throw new Error("Window and/or document is not defined");this.cemLogger=t.cemLogger||new r.default({renderId:t.renderId,isDebug:t.isDebug,stage:t.stage,market:t.locale,templateName:t.templateName}),this.aid=t.adId,this.cid=t.creativeId;var i=Math.random()>l;if(t.currentDate){var o=Math.random()>f,a=new Date(t.currentDate),u=a.getUTCHours(),c=a.getUTCMinutes(),d=4===u||5===u&&c<30;this.suppressViewabilityEventLogging=o&&d}this.visualCompleteness=new s.default(t.requiredElementsForVisualCompleteness,i),this.requiredElementsForVisualCompleteness=t.requiredElementsForVisualCompleteness,this.preDefinedUrlsForVisualCompleteness=t.preDefinedUrlsForVisualCompleteness,this.cemLogger.logImpression(),this.performanceEventManager=n,i||this.trackLoadLatency(),this.trackVisualCompletenessLatency(),this.attachGlobals(),this.addErrorListener()}return i(e,[{key:"attachGlobals",value:function(){this.window.document.ad={aid:this.aid,cid:this.cid},this.window.CemLogger=this.cemLogger,this.window.Viewability=o.default,this.window.VisualCompleteness=this.visualCompleteness}},{key:"trackVisualCompletenessLatency",value:function(){var e=this;this.visualCompleteness.startTimer(this.performanceEventManager.timers[u.VISUAL_COMPLETENESS_LATENCY]),this.requiredElementsForVisualCompleteness.forEach(function(t){if(e.preDefinedUrlsForVisualCompleteness[t]){var n=new Image;n.onload=function(){e.visualCompleteness.endTimer(t)},n.src=e.preDefinedUrlsForVisualCompleteness[t]}})}},{key:"trackLoadLatency",value:function(){var e=this;this.performanceEventManager.addListener(this.window,"load",function(){var t=new Date-e.performanceEventManager.timers[u.CREATIVE_LOAD_LATENCY];e.cemLogger.logPerformanceEvent(a.CEM_LOGGER_METRICS.EVENT_NAMES.CREATIVE_LOAD_LATENCY,t)})}},{key:"addErrorListener",value:function(){var e=this,t=function(t){e.cemLogger.logPerformanceEvent(a.CEM_LOGGER_METRICS.EVENT_NAMES.UNCAUGHT_ERROR,t)};this.performanceEventManager.onNewError=t;for(var n in this.performanceEventManager.events[u.UNCAUGHT_ERROR])t(n)}},{key:"addViewabilityListener",value:function(e){var t=this,n=new o.default(e,this.window);this.suppressViewabilityEventLogging||(n.getPercentInView()<=-1?this.cemLogger.logEvent({eventName:a.CEM_LOGGER_METRICS.EVENT_NAMES.VIEWABILITY_FAILURE,eventType:a.CEM_LOGGER_METRICS.EVENT_TYPES.VIEWABILITY,componentType:a.CEM_LOGGER_METRICS.COMPONENT_TYPES.CREATIVE,componentName:a.CEM_LOGGER_METRICS.COMPONENT_TYPES.CREATIVE}):n.onView(.5,1e3,function(){t.cemLogger.logEvent({eventName:a.CEM_LOGGER_METRICS.EVENT_NAMES.IN_VIEW,eventType:a.CEM_LOGGER_METRICS.EVENT_TYPES.VIEWABILITY,componentType:a.CEM_LOGGER_METRICS.COMPONENT_TYPES.CREATIVE,componentName:a.CEM_LOGGER_METRICS.COMPONENT_TYPES.CREATIVE})}))}}]),e}();t.default=d},function(e,t,n){e.exports=n(6)}]);