!function(document,window){var noReset72,globalFunctions=gtmDataLayer.get("dLPlatformFuncs")||{},pageLoadFunctions=gtmDataLayer.get("pageLoadSetVars")||{},countryAA=globalFunctions.countryAA(),spaPageType="",pageUrl=window.location.href;cookieBannerAvailable&&!expCookieTrue&&(window.s={},s.clearVars=s.tl=s.t=function(){}),pageLoadFunctions.allPages=function(isSPAChange){s.clearVars();var path=globalFunctions.pathNameNoLang(),isSPAroute=isSPAChange||null;spaPageType=gtmDataLayer.get("appRouteChanged.SPAPageType");var isBrowsePage=isSPAroute?"dcBrowse"==spaPageType:/\/shop.*|\/categories.*/i.test(path),isProductPage=isSPAroute?"dcProductDetails"==spaPageType:/\/products\/.*/.test(path),isSearchPage=isSPAroute?"dcSearch"==spaPageType:/\/search|\/groceries\/search|multi-search(-results)?.*/.test(path),isBuyListPage=isSPAroute?"dcBuylist"==spaPageType:/\/buy-lists.*|\/buylists.*/.test(path),isHomePage=isSPAroute?"dcHomepage"==spaPageType:/^\/$|^\/groceries\/$/.test(path),isFavPage=isSPAroute?"dcFavourites"==spaPageType:/\/favorites.*/.test(path),isPromoPage=isSPAroute?"dcPromotions"==spaPageType:/\/promotions.*/.test(path),isSlotsPage=isSPAroute?spaPageType.match(/dcSlots/i):/\/slots.*/.test(path),isTrolleyPage=isSPAroute?"dcTrolley"==spaPageType:/\/trolley/.test(path),isWarPage=isSPAroute?"dcRatingsReviewsSubmission"==spaPageType:/reviews\/submission.*/.test(path),isReviewSubmittedPage=isSPAroute?"dcReview"==spaPageType:/reviews\/thankyou.*/.test(path),isZonePage=isSPAroute?"dcZone"==spaPageType:/(\/zone|\/events).*/.test(path);!/UK/i.test(countryAA)&&/^\/groceries\/([a-zA-Z]{2})\-([a-zA-Z]{2})\/(account|register).*/.test(path)&&(s.pageURL=location.protocol+"//"+location.host+location.pathname),s.pageURL=[location.protocol,"//",location.host,location.pathname].join(""),s.channel=globalFunctions.countryAA(),s.eVar43=window.location.href,s.eVar9=s.prop10=globalFunctions.getSiteName(),s.prop8=navigator.language.toLowerCase(),s.prop20=countryAA,s.eVar57=s.prop24=globalFunctions.buildNameVersion(),s.prop43=document.documentElement.lang,s.prop70=gtmDataLayer.get("dLGlobalFuncs.AMCVMigrate"),s.eVar38=globalFunctions.storeLocationID(),s.eVar46=globalFunctions.storeID(),s.eVar54=gtmDataLayer.get("customerData.busCustomerTrkId"),s.events=s.events?s.events+=",event10":"event10";var gtmCustomerId,customerSlotState=gtmDataLayer.get("customerData.busCustomerSlotState");null!==customerSlotState&&(s.prop74=customerSlotState,gtmDataLayer.set("customerData.busCustomerSlotState",null)),s.eVar22=s.prop13=globalFunctions.customerType(),"logged in"===globalFunctions.customerType()&&(s.eVar51=gtmDataLayer.get("customerData.busCustomerLoyaltyType"),s.eVar114=gtmDataLayer.get("customerData.deliverySaverPlan"),void 0!==countryAA&&(gtmCustomerId="UK"==countryAA?_gtm.getCookie("CID"):gtmDataLayer.get("customerData.busCustomerUUID")?gtmDataLayer.get("customerData.busCustomerUUID"):gtmDataLayer.get("customerData.busCustomerHashedEmail")),s.eVar24=gtmCustomerId),"UK"!=gtmDataLayer.get("dLPlatformFuncs.countryAA")()&&(-1===document.location.pathname.toLowerCase().indexOf("/register")&&-1<document.referrer.toLowerCase().indexOf("/login")||-1<document.location.pathname.toLowerCase().indexOf("/register/setup")&&-1<document.referrer.toLowerCase().indexOf("/register"))&&"logged in"==gtmDataLayer.get("dLPlatformFuncs.customerType")()&&-1===document.cookie.indexOf("s_gpv_pn=homepage")&&(s.events=s.events?s.events+",event4":"event4"),gtmDataLayer.get("UIImpression.busRenderedProdViewString")&&(s.events=s.events?s.events+=",event3":"event3",s.products=gtmDataLayer.get("UIImpression.busRenderedProdViewString"),isProductPage||(s.events=s.events?s.events+=",event169":"event169"),gtmDataLayer.set("UIImpression.busRenderedProdViewString",!1)),s.currencyCode=globalFunctions.currencyCode(),s.prop32=s.eVar34=gtmDataLayer.get("customerData.busCustomerDevice"),s.eVar182=null!=gtmDataLayer.get("customerData.busNumberActiveOrders")?gtmDataLayer.get("customerData.busNumberActiveOrders").toString():"0",s.eVar6=gtmDataLayer.get("customerData.busCustomerSlotDateTime")?gtmDataLayer.get("customerData.busCustomerSlotDateTime"):null,s.eVar69=gtmDataLayer.get("customerData.busCustomerSlotMethod")?gtmDataLayer.get("customerData.busCustomerSlotMethod"):null;var filterSortVarArray=globalFunctions.filterSortArray();s.eVar147=filterSortVarArray.v147,s.eVar238=filterSortVarArray.v238,s.eVar239=filterSortVarArray.v239,s.eVar161=filterSortVarArray.v161,gtmDataLayer.get("UIEventFilterOp.event72")&&(s.events+=",event72",_gtm.getQueryParam("currentModal")&&"noResult"==_gtm.getQueryParam("currentModal")&&(s.events+=",event73",noReset72="true"),noReset72||(gtmDataLayer.set("UIEventFilterOp.event72",!1),noReset72=!1)),filterSortByInteraction();var storedVal,busUIRenderContentMagnolia,busUIRenderContentContentType,busUIRenderContentCampaign,clickedItem=_gtm.sessionStorage.get("ClickedItem"),engine=_gtm.sessionStorage.get("engine"),compType=_gtm.sessionStorage.get("compType");clickedItem&&(storedVal=clickedItem,s.list2=storedVal,function manageEngineOnClick(clickedItem){~clickedItem.indexOf("t:")||~clickedItem.indexOf("c:")?_gtm.sessionStorage.set("clickedItemStored",storedVal):gtmDataLayer.set("UIRenderContent.clickedEngineStored",engine),_gtm.sessionStorage.remove("ClickedItem"),engine&&(s.eVar166=engine,gtmDataLayer.set("UIRenderContent.clickedEngineStored",engine),_gtm.sessionStorage.set("clickedEngineStored",engine),_gtm.sessionStorage.remove("engine")),compType&&(gtmDataLayer.set("UIRenderContent.clickedTypeStored",compType),_gtm.sessionStorage.remove("compType"))}(clickedItem)),"DCHPSugClick"==_gtm.sessionStorage.get("DCHPSugClick")&&(_gtm.sessionStorage.remove("DCHPSugClick"),gtmDataLayer.set("UIRenderContent.clickedItemStored","DCHP"),_gtm.sessionStorage.get("engine")&&(s.eVar166=_gtm.sessionStorage.get("engine"),gtmDataLayer.set("UIRenderContent.clickedEngineStored",_gtm.sessionStorage.get("engine")),_gtm.sessionStorage.remove("engine"))),-1===pageUrl.indexOf("help")&&(busUIRenderContentMagnolia=gtmDataLayer.get("UIRenderContent.busUIRenderContentMagnolia"),busUIRenderContentContentType=gtmDataLayer.get("UIRenderContent.busUIRenderContentContentType"),busUIRenderContentCampaign=gtmDataLayer.get("UIRenderContent.busUIRenderContentCampaign"),busUIRenderContentMagnolia&&(s.list2?s.list2+="|"+busUIRenderContentMagnolia:s.list2=busUIRenderContentMagnolia,s.eVar166="dcs","video"!=busUIRenderContentContentType&&"auto-play video"!=busUIRenderContentContentType||(s.eVar177=busUIRenderContentContentType,busUIRenderContentCampaign&&(s.prop22=busUIRenderContentCampaign,s.eVar26="D=c22")),gtmDataLayer.set("UIRenderContent.busUIRenderContentMagnolia",!1)));var appConsumer=globalFunctions.appConsumerAA(),appSiteNamePlatform=globalFunctions.appSiteNamePlatform(),appXamerinVid=globalFunctions.appVisitorId();globalFunctions.appVisitorId()||-1!==appConsumer.indexOf("ghsnativeapp")?(s.prop23=globalFunctions.appDeviceNameVersion(),s.eVar56=s.prop23,s.prop24=appSiteNamePlatform,s.eVar57=s.prop24):"mca-th"==appConsumer&&(s.prop24=appSiteNamePlatform,s.eVar57=s.prop24),appXamerinVid&&(s.visitorID=appXamerinVid);var _ogp,_opd,amendMode=gtmDataLayer.get("customerData.busCustomerAmendMode");amendMode&&(s.prop34=amendMode,s.eVar41=s.prop34),(gtmDataLayer.get("customerData.busCustomerAmendStart")||null)&&(_ogp=gtmDataLayer.get("UIEventBasket.busBasketStateGuidePrice")||null,_opd=gtmDataLayer.get("UIEventBasket.busBasketStateUnitsCount")||null,"undefined"!=typeof Storage&&(_gtm.localStorage.set("gtm_amd_opd",_opd),_gtm.localStorage.set("gtm_amd_ogp",_ogp))),_gtm.sessionStorage.get("dtmPassVal")&&(s.eVar45=_gtm.sessionStorage.get("dtmPassVal").toLowerCase(),s.events+=",event45",_gtm.sessionStorage.remove("dtmPassVal"));var dateDay,dateMonth,friendlyTodayCode,todayDateCode="",busExpTodayDate=gtmDataLayer.get("UIExperimentRendered.busExpTodayDate");if(busExpTodayDate?todayDateCode=Date.parse(busExpTodayDate):((dateDay=(dateDay=(todayDateCode=new Date).getDate()).toString()).length<2&&(dateDay="0"+dateDay),(dateMonth=(dateMonth=todayDateCode.getMonth()+1).toString()).length<2&&(dateMonth="0"+dateMonth),friendlyTodayCode=todayDateCode.getFullYear()+"-"+dateMonth+"-"+dateDay,gtmDataLayer.set("UIExperimentRendered.busExpTodayDate",friendlyTodayCode)),_gtm.localStorage.get("OptVars")){var prevOptStr=_gtm.localStorage.get("OptVars"),gtmCleanPrevExpArray=[],cleanArrayToStore=[],prevOptArray=JSON.parse(prevOptStr);for(i=0;i<prevOptArray.length;i++){var cleanPrevOptObj,prevExpVar=prevOptArray[i].V,prevExpDateFriendly=prevOptArray[i].D;todayDateCode-Date.parse(prevExpDateFriendly)<24192e5&&(cleanPrevOptObj={V:prevExpVar,D:prevExpDateFriendly},gtmCleanPrevExpArray.push(JSON.stringify(cleanPrevOptObj)),gtmDataLayer.set("UIExperimentRendered.busExpPast",gtmCleanPrevExpArray),cleanArrayToStore.push(cleanPrevOptObj))}if(gtmCleanPrevExpArray=gtmCleanPrevExpArray.sort(),gtmDataLayer.set("UIExperimentRendered.busAllExperiments",gtmCleanPrevExpArray),0<cleanArrayToStore.length)try{_gtm.localStorage.set("OptVars",JSON.stringify(cleanArrayToStore))}catch(err){}}var allExpArray=gtmDataLayer.get("UIExperimentRendered.busAllExperiments");if(allExpArray){var allExpString="",arrayForAdobeVar=[];for(i=0;i<allExpArray.length;i++){var thisExpObj=JSON.parse(allExpArray[i]);arrayForAdobeVar.push(thisExpObj),allExpString+=JSON.parse(allExpArray[i]).V,i<allExpArray.length-1&&(allExpString+=",")}s.eVar50=allExpString}var server1,busSiteApplication=gtmDataLayer.get("siteData.busSiteApplication");busSiteApplication&&(server1=document.location.host+" ("+busSiteApplication+")");var server=globalFunctions.server();s.server=server1||server,s.eVar102=_gtm.getCookie("UUID");var icidValue=_gtm.getQueryParam("icid");icidValue&&(s.eVar2=icidValue,s.events=s.events?s.events+=",event7":"event7");var uicc=_gtm.localStorage.get("uicc");uicc&&("null"!==uicc&&(s.eVar2=uicc),_gtm.localStorage.remove("uicc")),/\/forgot-password.*|.*\/login|\/account|\/password-updated|\/register.*|\/reset-password|\/confirm-otp/.test(path)&&pageLoadFunctions.accountPagesAA(),/\/orders((?!.*confirmation))/i.test(path)&&pageLoadFunctions.orderPagesAA(),"secure.opinionlab.com"==document.domain&&pageLoadFunctions.opinionLabPageAA(),/\/orders\/[0-9]+\/confirmation$|.*\/checkout\/order-confirmation$|.*\/checkout\/confirmation/i.test(path)&&pageLoadFunctions.confirmationPageAA(),isHomePage&&pageLoadFunctions.homePageAA(),isBrowsePage&&pageLoadFunctions.browsePagesAA(),isProductPage&&pageLoadFunctions.productPagesAA(),isSearchPage&&pageLoadFunctions.searchPagesAA(),isFavPage&&pageLoadFunctions.favoritesPagesAA(),isBuyListPage&&pageLoadFunctions.buyListPagesAA(),isPromoPage&&pageLoadFunctions.promotionPagesAA(),isSlotsPage&&pageLoadFunctions.slotsPagesAA(),isTrolleyPage&&pageLoadFunctions.trolleyPageAA(),/review-trolley.*/.test(path)&&pageLoadFunctions.reviewTrolleyPageAA(),/order-summary.*/.test(path)&&pageLoadFunctions.orderSummaryPageAA(),/checkout\/recommendations.*/.test(path)&&pageLoadFunctions.recommendationsPageAA(),/payment-options.*/.test(path)&&"UK"!=countryAA&&pageLoadFunctions.paymentOptionsPageAA(),/checkout\/(?!confirmation|review-trolley|order-summary|payment-options).*/.test(path)&&pageLoadFunctions.checkoutCatchAllAA(),isWarPage&&pageLoadFunctions.warPageAA(),isReviewSubmittedPage&&pageLoadFunctions.reviewConfirmationAA(),/\/help.*/.test(path)&&pageLoadFunctions.helpPageAA(),isZonePage&&pageLoadFunctions.zonePageAA(),"error"==document.body.dataset.page&&pageLoadFunctions.errorPagesAA(),s.eVar3=s.prop4+":"+s.prop1,s.eVar4=s.prop3;try{var _gtmBasketId=gtmDataLayer.get("UIEventBasket.busBasketStateBasketId"),_gtmBasketItems=gtmDataLayer.get("UIEventBasket.busBasketItems");_gtm.notify("GTM: _gtmBasketID: ",_gtmBasketId),_gtmBasketId=null==_gtmBasketId||null==_gtmBasketId?"not set":(_gtmBasketId=_gtmBasketId.split("_"))[0],-1===pageUrl.indexOf("confirmation")&&(s.prop60=s.eVar60=_gtmBasketId,_gtmBasketItems&&(s.prop47=_gtmBasketItems.length,s.eVar191=s.prop47))}catch(err){console.log("GTM error"+err)}_gtm.notify("GTM: allPages fired"),cookieBannerAvailable&&!expCookieTrue?gtmDataLayer.get("adobeTags").sendImagePixel("pageLoad",s):s.t(),gtmDataLayer.set("pageLoadSetVars",pageLoadFunctions)};var filterSortByInteraction=function(){document.getElementById("sort-by")&&document.getElementById("sort-by").addEventListener("change",function(e){gtmDataLayer.set("UIEventFilterOp.event72",!0)})}}(document,window);