bertie.on("trolleyAmend",function(e){try{var unitsEvent,revEvent,amendTrolleyObj={amendTrolleyIsAmend:!0},stringToSend=[],hasItemsAdded="false",hasItemsRemoved="false",guidePriceChange=0;e.items.forEach(function(item){var prodMeth,productInfo=[],isFav=item.isFav||null;switch(item.priceBreakdown&&item.priceBreakdown.unitOfMeasure||"empty"){case"pcs":prodMeth="q";break;case"kg":prodMeth="w";break;default:prodMeth="u"}var prodQtyVal=item.qtyChange||null;0<prodQtyVal&&(ProdAmendType="Increase",unitsEvent="event49=",revEvent="event50=",weightEvent="event154=",singleWeightEvar="evar134=",totalWeightEvar="evar=136",hasItemsAdded="true"),prodQtyVal<0&&(ProdAmendType="Decrease",unitsEvent="event51=",revEvent="event52=",weightEvent="event155=",singleWeightEvar="evar134=",totalWeightEvar="evar126=",hasItemsRemoved="true");var prodQty=Math.abs(prodQtyVal),prodPriceChange=parseFloat(item.priceChange.price)||null,prodRevVal=prodPriceChange?prodPriceChange.toFixed(2):null,prodRev=Math.abs(prodRevVal);guidePriceChange+=prodPriceChange,productInfo.push(null,item.tpnb,null,null);var amendEvents=unitsEvent+prodQty+"|"+revEvent+prodRev;productInfo.push(amendEvents);var amendEvars="evar130="+prodMeth,onPromotion=item["tesco:promotion"].onPromotion||null,promotionType=item["tesco:promotion"].promotionType||null,clubcardOffer=item["tesco:promotion"].clubcardOffer||null;0<prodQtyVal&&(amendEvars+=isFav?"|evar128=fav":"",amendEvars+=onPromotion?"|eVar186="+promotionType:"|eVar186=no",amendEvars+=clubcardOffer?"|evar123=y":"|evar123=n"),productInfo.push(amendEvars),stringToSend.push(productInfo.join(";"))}),amendTrolleyObj.amendTrolleyProductString=stringToSend.join(","),amendTrolleyObj.amendTrolleyItemsAdded=hasItemsAdded,amendTrolleyObj.amendTrolleyItemsRemoved=hasItemsRemoved,amendTrolleyObj.amendTrolleyGuidePriceChange=guidePriceChange,dataLayer.push({amendTrolley:amendTrolleyObj})}catch(e){var errorsObj=gtmDataLayer.get("errors")||{};errorsObj.amendTrolley="Unavailable",errorsObj.amendTrolley.eMesssage=e,gtmDataLayer.set("errors",errorsObj)}});