bertie.on("UIEventBasketOp",function(e){try{var UIEventBasketOpObj,basketString,pathname=gtmDataLayer.get("dLPlatformFuncs").pathNameNoLang(),engine=gtmDataLayer.get("UIRenderContent.busUIRenderContentEngine")||null,basketId=e.basketId||"not set";basketId&&0<=basketId.indexOf("_")&&(basketString=basketId.indexOf("_"),basketId=basketId.substring(0,basketString));var addIdent=e.identifier||null,anonymous=e.anonymous||null;1==anonymous&&(anonymous="y");var isOpen=e.isOpen||null,basketIntType=e.type||null,gridProductArray=gtmDataLayer.get("UIImpression.gridProductArray")||null,gridProductArrayId=gridProductArray?gridProductArray.map(function(x){return x["@id"]}):null,favProductArray=gtmDataLayer.get("UIImpression.favProductArray")||null,favProductArrayId=favProductArray?favProductArray.map(function(x){return x["@id"]}):null,lvar="",trexId=e.products[0].trexId||null,storedEngine=gtmDataLayer.get("UIRenderContent.clickedEngineStored")||null,clickedItemStored=_gtm.sessionStorage.get("clickedItemStored")||null,linkNameBasic="",linkNameAppend="",isAddAll="",isSuggested="",SPEngine="",missedOffer="",seedProductId="",unitsEvent="",revEvent="",weightEvent="",weightEvar="",productIds=[],basketOpAisle="",basketOpDepartment="",basketOpSuperDepartment="",basketOpName="",basketOpProductId="",basketOpPrice="",prodQuantity="";"addProduct"===basketIntType&&(unitsEvent="event26=",revEvent="event27=",weightEvent="event152=",weightEvar="evar135="),"removeProduct"===basketIntType&&(unitsEvent="event28=",revEvent="event29=",weightEvent="event153=",weightEvar="evar133="),"removeAllProducts"===basketIntType&&(unitsEvent="event28=",revEvent="event29=",weightEvent="event153=",weightEvar="evar133=");var stringToSend=[],hasWeightedProd="false",unitsPerProd=[],totalItemsCount=0,rank=null,productPageTrue=/^\/groceries\/[a-zA-Z]{2}\-[a-zA-Z]{2}\/products\/.*$/.test(location.pathname);e.products.forEach(function(item){rank=item.sugProdPos?item.sugProdPos:addIdent&&"Page"==addIdent&&null!=gridProductArrayId&&!productPageTrue?gridProductArrayId.indexOf(item.product["@id"])+1:addIdent&&"carousel:favourites"==addIdent&&null!=favProductArrayId?favProductArrayId.indexOf(item.product["@id"])+1:item.gridPos?item.gridPos:null;var onPromotion=item.product["tesco:promotion"].onPromotion||null,promotionType=item.product["tesco:promotion"].promotionType||null,promotionName=item.product["tesco:promotion"].promotionName||null,mealDeal=promotionName?/MEAL DEAL/.test(promotionName):null,promoEvar="",clubcardOffer=item.product["tesco:promotion"].clubcardOffer||null,promoEvar=onPromotion&&mealDeal?"md":onPromotion&&!mealDeal?promotionType:"no";item.missedOffer&&(missedOffer=item.missedOffer);var retrieveObj,i,placesToAdd,placement=item.sugProdPos||null;_gtm.sessionStorage.get("listStoreSP")&&(retrieveObj=JSON.parse(_gtm.sessionStorage.get("listStoreSP")),placement&&(i=0,JSON.parse(_gtm.sessionStorage.get("listStoreSP")).forEach(function(element){-1==element.indexOf(trexId)||placesToAdd||1!==(placesToAdd=i)&&(placement+=placesToAdd),i++}),lvar=retrieveObj[placement-1])),item.product&&item.product.seedProduct&&(seedProductId=item.product.seedProduct["@id"]);var prodMeth,productInfo=[],isFav=item.product.isFav||null;switch(item.measure||"empty"){case"pcs":prodMeth="q";break;case"kg":prodMeth="w";break;default:prodMeth="u"}var tpnb=item.product.productID||null,prodQty=item.quantity||null,aTotalWeight=parseFloat(item.weight).toFixed(2)||"na",perUnitWeight="";"w"==prodMeth&&"na"!=aTotalWeight&&(perUnitWeight=parseFloat(aTotalWeight/prodQty).toFixed(2),hasWeightedProd="true");var prodRevRaw,prodRev="";item.product.offers.forEach(function(offers){prodRevRaw=parseFloat(offers.price),prodRev=parseFloat(prodRevRaw).toFixed(2)}),productInfo.push(null,tpnb,null,null);var prodEventStr=unitsEvent+prodQty+"|"+revEvent+prodRev;null!==rank&&"removeProduct"!=basketIntType&&(prodEventStr+="|event169="+rank),prodEventStr+="w"===prodMeth?"|"+weightEvent+aTotalWeight:"",productInfo.push(prodEventStr);var prodEvarStr="evar130="+prodMeth;prodEvarStr+="w"===prodMeth?"|"+weightEvar+aTotalWeight+"|eVar134="+perUnitWeight:"",prodEvarStr+="|eVar186="+promoEvar,null!==rank&&"removeProduct"!=basketIntType&&(prodEvarStr+="|eVar98="+rank),"addProduct"!==basketIntType&&"addAllProducts"!==basketIntType||(prodEvarStr+=isFav?"|evar128=fav":""),prodEvarStr+=clubcardOffer?"|eVar123=y":"|eVar123=n",item.product&&item.product["tesco:flags"]&&item.product["tesco:flags"].SUB&&item.product["tesco:flags"].seedLookup&&(prodEvarStr+="|eVar64="+item.product["tesco:flags"].seedLookup),productInfo.push(prodEvarStr),stringToSend.push(productInfo.join(";")),unitsPerProd.push(prodQty),totalItemsCount=unitsPerProd.reduce(function add(a,b){return a+b},0),basketOpAisle=item.product.hierarchy.aisle,basketOpDepartment=item.product.hierarchy.department,basketOpSuperDepartment=item.product.hierarchy.superDepartment,basketOpName=item.product.name,basketOpProductId=item.product.productID,basketOpPrice=item.product.offers[0].price,prodQuantity=item.quantity}),engine?SPEngine=engine:(sessionStorage&&_gtm.sessionStorage.get("renderEngine")&&(SPEngine=_gtm.sessionStorage.get("renderEngine")),_gtm.sessionStorage.remove("renderEngine"));var searchAdd="/search"!=pathname&&"/multi-search-results"!=pathname||"Page"!=addIdent&&"unknown"!=addIdent?!1:"y";"removeAllProducts"==basketIntType&&(addIdent="emptyBasket");var addType="",pageEnd="plp";switch(pathname.match(/products/)&&(pageEnd="pdp"),pathname.match(/have-you-forgotten/)&&(pageEnd+=":hyf"),addIdent){case"unknown":addType=":unknown area";break;case"Side Basket":addType=":side basket";break;case"Page":clickedItemStored?0<=clickedItemStored.indexOf("c:")?(addType=":"+pageEnd,isSuggested="isSuggestedClicked",gtmDataLayer.set("UIRenderContent.busUIRenderContentEngine",null),engine=null):isSuggested="DCHP"==clickedItemStored?(addType=":recommender:"+storedEngine,linkNameAppend=" suggested product","isSuggestedDCHPClicked"):(addType=":recommender:"+storedEngine,linkNameAppend=" suggested product","isSuggestedClicked"):addType=":"+pageEnd;break;case"emptyBasket":addType=":basket empty";break;case(addIdent.match(/recommender.*/)||{}).input:addType=":recommender:"+SPEngine,linkNameAppend=" suggested product",isSuggested="isSuggested";break;case(addIdent.match(/carousel.*/)||{}).input:addType=":"+addIdent.toLowerCase();break;case"RCMD:WNT":case"CMD:WNT":addType=":why not try";break;case"RCMD:SUB":addType=":substitution";break;case"Promoted":addType=":promoted";break;case"frequently bought":addType=":frequently bought";break;default:addType=":unknown area"}switch(missedOffer&&(addType+=":missed offer"),basketIntType){case"addProduct":linkNameBasic="Basket Add"+linkNameAppend;break;case"addAllProducts":linkNameBasic="Basket Add"+linkNameAppend,isAddAll=!0;break;case"removeProduct":linkNameBasic="Basket Remove";break;case"removeAllProducts":linkNameBasic="Basket Empty";break;default:linkNameBasic="basket interaction"}0<e.products.length&&e.products.map(function(x){productIds.push(x.product["@id"])}),UIEventBasketOpObj={busBasketOpProdString:stringToSend,busBasketOpTotalItemsCount:totalItemsCount,busBasketOpHasWeighted:hasWeightedProd,busBasketOpIsAnon:anonymous,busBasketOpAddIdentifier:addIdent,busBasketOpIsOpen:isOpen,busBasketOpIsSearch:searchAdd,busBasketOpAddType:addType,busBasketOpSeedProductId:seedProductId,busBasketOpIsSPAdd:isSuggested,busBasketOpInteractionType:basketIntType,busBasketOpLinkName:linkNameBasic,busBasketOpIsAddAll:isAddAll,busBasketOpSugProdList:lvar,busOpProductIds:productIds,busBasketOpSuperDepartment:basketOpSuperDepartment,busBasketOpDepartment:basketOpDepartment,busBasketOpAisle:basketOpAisle,busBasketOpProdQty:prodQuantity,busBasketOpUnitPrice:basketOpPrice,basketOpName:basketOpName,basketOpProductId:basketOpProductId,busOpProdArray:e.products},gtmDataLayer.set("UIEventBasketOp",UIEventBasketOpObj),setTimeout(function(){cookieBannerAvailable&&!expCookieTrue?gtmDataLayer.get("adobeTags").sendImagePixel("basketInteraction",s):gtmDataLayer.get("customEventSetVars.basketInteractAA")(),cookieBannerAvailable&&!advCookieTrue||("addProduct"===basketIntType&&gtmDataLayer.get("marketingInteractions").gaBasketAdd(),"addProduct"!==basketIntType&&"addAllProducts"!==basketIntType||(gtmDataLayer.get("marketingInteractions").facebookBasketAdd(),gtmDataLayer.get("marketingInteractions").amobeeBasketAdd()))},700)}catch(e){var errorsObj=gtmDataLayer.get("errors")||{};errorsObj.UIEventBasketOp="Unavailable",errorsObj.UIEventBasketOp.eMesssage=e,gtmDataLayer.set("errors",errorsObj)}});